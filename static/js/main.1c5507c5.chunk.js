(this["webpackJsonpphrase-loop-player"]=this["webpackJsonpphrase-loop-player"]||[]).push([[0],{131:function(e,t,a){"use strict";a.r(t);var n,r=a(0),o=a.n(r),c=a(7),u=a.n(c),l=a(8),s=a(135),i=a(30),m=(a(84),a(14)),d=a.n(m),p=a(24),f=a(136),v=a(67),b=a(134),g=a(137),h=a(28),E=a(65),O=function(e){var t=e.setInputValues;return o.a.createElement(h.a,{initialValues:{url:"",averageDuration:5},onSubmit:function(){var e=Object(p.a)(d.a.mark((function e(a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:localStorage.setItem("loopIndex",0),t(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},(function(e){var t=e.values,a=e.handleChange,n=e.handleSubmit;return o.a.createElement(f.a,{onSubmit:n},o.a.createElement(f.a.Row,{className:"d-md-flex"},o.a.createElement(f.a.Group,{as:v.a,sm:"12",xl:"8",className:"d-flex"},o.a.createElement(b.a.Text,null,"url"),o.a.createElement(f.a.Control,{name:"url",type:"text",value:t.url,onChange:a})),o.a.createElement(f.a.Group,{as:v.a,sm:"12",xl:"3",className:"d-flex"},o.a.createElement(b.a.Text,null,"average duration"),o.a.createElement(f.a.Control,{name:"averageDuration",type:"number",value:t.averageDuration,onChange:a})),o.a.createElement(v.a,{sm:"12",xl:"1"},o.a.createElement(g.a,{block:!0,type:"submit",className:"mb-3 mx-0"},"submit"))),o.a.createElement(E.a,{name:"settings",debounce:100}))}))},y=a(17),j=a(44),x=a(68),k=a(69),w=a.n(k),S=a(27),I=a.n(S),C=a(70),N=(a(123),a(71)),R=a.n(N),D=a(72),P=a(29);var M=function(e){var t=e.regions,a=e.duration,n=e.loopRegion,c=e.setLoopRegion,u=e.playedSeconds,s=Object(r.useMemo)((function(){return t.reduce((function(e,t){var a=t.start,r=t.end;return a<n.start-10||r>n.end+10||(e[a]=Number(a.toFixed(1)),e[r]=Number(r.toFixed(1))),e}),{})}),[n.end,n.start,t]),i=n?[n.start,n.end]:[u,u];return o.a.createElement(P.a,{value:i,min:Math.max(0,n.start-10),max:Math.min(a,n.end+10),step:.01,marks:s,onChange:function(e){var t=Object(l.a)(e,2),a=t[0],n=t[1];c({start:a,end:n})}})};var L=function(e){var t=e.url,a=e.regions,c=Object(r.useRef)(),u=Object(r.useState)(),s=Object(l.a)(u,2),i=s[0],m=s[1],d=Object(r.useState)(0),p=Object(l.a)(d,2),f=p[0],v=p[1],h=Object(r.useState)(1),E=Object(l.a)(h,2),O=E[0],y=E[1],j=Object(r.useState)({playedSeconds:0}),x=Object(l.a)(j,2),k=x[0],w=function(e){var t=e.setPlayer,a=e.setDuration,n=e.playerRef,o=e.setVideoState;return{onReady:Object(r.useCallback)((function(){t(n.current),a(n.current.getDuration())}),[n,a,t]),onProgress:Object(r.useCallback)((function(e){o(e)}),[o])}}({setPlayer:m,setDuration:v,playerRef:c,setVideoState:x[1]}),S=w.onReady,C=w.onProgress,N=function(e){var t=I()("loopIndex",0),a=Object(l.a)(t,2),n=a[0],o=a[1],c=Object(r.useCallback)((function(t){var a=Math.min(t+n,e.length-1),r=Math.max(a,0);o(r)}),[n,e,o]);return{loopIndex:n,setLoopIndex:o,addLoopIndex:c}}(a),L=N.loopIndex,T=N.setLoopIndex,V=N.addLoopIndex,F=Object(r.useState)(a[L]),J=Object(l.a)(F,2),G=J[0],B=J[1];!function(e){var t=e.player,a=e.loopRegion;Object(r.useEffect)((function(){if(clearInterval(n),!t||!a)return function(){};var e=a.start,r=a.end;return n=setInterval((function(){var a=t.getCurrentTime();a<e&&t.seekTo(e,"seconds"),a>r&&t.seekTo(e,"seconds")}),25),function(){return clearInterval(n)}}),[a,t])}({player:i,loopRegion:G}),Object(r.useEffect)((function(){B(a[L])}),[L,a]);var H=Object(r.useCallback)((function(e){B(null);var t=a.findIndex((function(t){var a=t.start,n=t.end;return a<e&&e<n}));-1!==t&&T(t)}),[a,T]),W={next:function(){return V(1)},previous:function(){return V(-1)}};return a&&0!==a.length&&G?o.a.createElement(D.GlobalHotKeys,{keyMap:{next:["right"],previous:["left"]},handlers:W,allowChanges:!0},o.a.createElement("h5",null,"player"),o.a.createElement(R.a,{playing:!0,ref:c,url:t,onReady:S,onProgress:C,width:"100%",height:window.innerHeight/2,playbackRate:O}),o.a.createElement(P.b,{className:"my-5",value:k.playedSeconds,min:0,max:f,step:.01,onChange:H}),o.a.createElement(M,{regions:a,duration:f,loopRegion:G,setLoopRegion:B,playedSeconds:k.playedSeconds}),o.a.createElement("div",{className:"mt-5 d-flex"},o.a.createElement(g.a,{className:"mr-1",onClick:function(){return V(-1)}},"Previous"),o.a.createElement(g.a,{className:"mr-1",onClick:function(){return V(1)}},"Next"),o.a.createElement(b.a.Text,{className:"mr-1"},"playback rate"),[.25,.5,.75,1,1.25,1.5].map((function(e){return o.a.createElement(g.a,{variant:"outline-secondary",className:"mr-1",key:e,active:O===e,onClick:function(){return y(e)}},e)}))),o.a.createElement("p",null,G.text)):o.a.createElement("div",null)};function T(e){var t=e.url,a=e.averageDuration,n=I()("regions"),c=Object(l.a)(n,2),u=c[0],s=c[1];return Object(r.useEffect)((function(){t&&function(e){V.apply(this,arguments)}({url:t,setRegions:s,averageDuration:a})}),[a,s,t]),u&&0!==u.length?o.a.createElement(L,{url:t,regions:u}):o.a.createElement("div",null)}function V(){return(V=Object(p.a)(d.a.mark((function e(t){var a,n,r,o,c,u,s,m,p,f,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.url,n=t.setRegions,r=t.averageDuration,o=w.a.parse(a.match(/\?(.*)/g).pop()),c=o.v,e.next=4,Object(x.a)(Object(C.getSubtitles)({videoID:c,lang:"en",url:"https://cors.yoyota.dev/https://www.youtube.com"}));case 4:u=e.sent,s=Object(l.a)(u,2),m=s[0],p=s[1],m&&i.b.error(JSON.stringify(m,Object.getOwnPropertyNames(m))),f=F(p),v=J({averageDuration:r,regions:f}),n(null),n(v);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return e?e.length<3?e:e[0].end===e[2].start?e.reduce((function(t,a,n){if(n%2===1){var r=e[n-1],o=Object(j.a)(Object(j.a)({},r),{},{text:"".concat(r.text," ").concat(a.text)});return t.pop(),[].concat(Object(y.a)(t),[o])}return[].concat(Object(y.a)(t),[a])}),[]):e:[]}function J(e){var t=e.regions,a=e.averageDuration;return t&&0!==t.length?t.reduce((function(e,t){var n=t,r=Math.round(n.dur/a),o=n.dur/r;if(r<2)return[].concat(Object(y.a)(e),[n]);var c=Object(y.a)(Array(r).keys()).map((function(e){var t=n.start+e*o;return{dur:o,start:t,end:t+o,text:n.text}}));return[].concat(Object(y.a)(e),Object(y.a)(c))}),[]):[]}var G=function(){var e=Object(r.useState)((JSON.parse(localStorage.getItem("settings"))||{}).values),t=Object(l.a)(e,2),a=t[0],n=t[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement(i.a,null),o.a.createElement(s.a,null,o.a.createElement("h1",null,"Phrase loop player"),o.a.createElement(O,{setInputValues:n}),o.a.createElement(T,a)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var B=a(75),H=a(76),W=a(78),A=a(77),K=function(e){Object(W.a)(a,e);var t=Object(A.a)(a);function a(e){var n;return Object(B.a)(this,a),(n=t.call(this,e)).state={hasError:!1},n}return Object(H.a)(a,[{key:"render",value:function(){var e=this.state,t=this.props;return e.hasError?o.a.createElement("h1",null," Something went wrong. "):t.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0,error:e}}}]),a}(o.a.Component),$=function(){return o.a.createElement(K,null,o.a.createElement(G,null))};u.a.render(o.a.createElement($,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},79:function(e,t,a){e.exports=a(131)}},[[79,1,2]]]);
//# sourceMappingURL=main.1c5507c5.chunk.js.map